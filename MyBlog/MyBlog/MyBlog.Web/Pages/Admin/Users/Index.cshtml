@page
@model MyBlog.Web.Pages.Admin.Users.IndexModel
@{
}
<div class="bg-secondary bg-opacity-10 py-2 mb-5">
    <div class="container">
        <h1>Users</h1>
    </div>
</div>


 <div>
     <div class="container">
         <table class="table">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Username</th>
                        <th>Email</th>
                      
                    </tr>
                </thead>
                <tbody >
                    @foreach (var user in Model.Users)
                    {
                        <tr>
                            <td>@user.Id</td>
                            <td>@user.Username</td>
                            <td>@user.Email</td>
                        </tr>
                    }
                </tbody>
                </tbody>
         </table>
     </div>
 </div>


@section Scripts {
    <script>
        const userListElement = document.getElementById('userList');
        const saveBtn = document.getElementById('btnSave');
        const usernameElement = document.getElementById('txtUsername');
        const emailElement = document.getElementById('txtEmail');
        const passwordElement = document.getElementById('txtPassword');
        const adminCheckboxElement = document.getElementById('adminCheckbox');
        function getUsers() {
            fetch('/admin/users/index?handler=users', {
                method: 'GET',
                headers: {
                    'Accept': '*/*'
                }
            }).then(data => data.text())
                .then(result => userListElement.innerHTML = result);
        }
        function addUser() {
            const roles = ['User'];
            if (adminCheckboxElement.checked) {
                roles.push(adminCheckboxElement.value)
            }
            console.log(usernameElement.value, emailElement.value, passwordElement.value, roles);
            const body = {
                username: usernameElement.value,
                email: emailElement.value,
                password: passwordElement.value,
                roles: roles
            };
            fetch('/api/user/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': '*/*'
                },
                body: JSON.stringify(body)
            }).then(() => {
                getUsers();
                $('#addUserModal').modal('hide');
                usernameElement.value = '';
                emailElement.value = '';
                passwordElement.value = '';
            });
        }
        getUsers();
        saveBtn.addEventListener('click', addUser);
    </script>
    }